<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××œ×•× ×™× 8 - ××¡×š ×œ×•×‘×™ ×—×›×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        glass: 'rgba(30, 41, 59, 0.7)',
                        glassBorder: 'rgba(255, 255, 255, 0.08)',
                        accent: '#38bdf8', // Sky 400
                        accentGlow: 'rgba(56, 189, 248, 0.3)',
                        gold: '#fbbf24',
                        goldGlow: 'rgba(251, 191, 36, 0.2)',
                    },
                    fontFamily: {
                        heebo: ['Heebo', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'flame': 'flame 1.5s infinite ease-in-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        flame: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '1' },
                            '50%': { transform: 'scale(1.1)', opacity: '0.8' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Heebo', sans-serif; }
        html, body { height: 100%; overflow: hidden; }
        
        /* Dynamic Background Base */
        body {
            /* Default fallback (Night) */
            background: radial-gradient(circle at top left, #020617 0%, #0b1120 18%, #111827 42%, #1e293b 75%, #020617 100%);
            background-size: 200% 200%;
            animation: background-pulse 30s ease-in-out infinite;
            color: #ffffff;
            transition: background 2s ease-in-out;
        }

        @keyframes background-pulse {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 0%; }
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(30, 41, 59, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .glass-header {
            background: linear-gradient(180deg, rgba(2, 6, 23, 0.6) 0%, rgba(2, 6, 23, 0.0) 100%);
        }

        .title-gradient {
            background: linear-gradient(90deg, #e5f2ff, #ffffff, #bfdbfe);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(56, 189, 248, 0.4);
        }

        .text-shadow-md { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }
        
        @keyframes marquee-rtl {
            0% { transform: translateX(0%); }
            100% { transform: translateX(50%); }
        }
        .marquee-content {
            animation: marquee-rtl 60s linear infinite;
            display: flex;
            white-space: nowrap;
        }
        
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(239, 68, 68, 0.2), inset 0 0 0 1px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.4), inset 0 0 0 1px rgba(239, 68, 68, 0.6); }
        }
        .priority-notice {
            animation: glow-pulse 3s infinite;
            border: 1px solid rgba(239, 68, 68, 0.3) !important;
            background: rgba(239, 68, 68, 0.05) !important;
        }
        
        input, select, textarea {
            background: rgba(255,255,255,0.05) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            color: white !important;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #38bdf8 !important;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
        }
        
        .icon-box {
            display: flex; align-items: center; justify-content: center;
            border-radius: 12px;
            backdrop-filter: blur(4px);
        }

        .ynet-icon {
            width: 20px; height: 20px;
            border-radius: 50%;
            background-color: #e50914;
            color: white;
            font-weight: 900;
            font-size: 12px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="font-heebo antialiased selection:bg-accent selection:text-white">

    <!-- ==================== TOP BAR ==================== -->
    <header class="fixed top-0 left-0 right-0 z-20 pt-6 pb-8 px-6 lg:px-10 glass-header">
        <div class="max-w-[1920px] mx-auto flex items-end justify-between">
            <!-- Right: Date & Time -->
            <div class="flex flex-col text-right">
                <div id="header-time" class="text-6xl font-bold tracking-tight text-white drop-shadow-lg leading-none text-shadow-md" style="font-variant-numeric: tabular-nums;">--:--</div>
                <div class="flex items-center gap-3 mt-1 text-blue-100">
                    <span id="header-day" class="text-3xl font-medium text-shadow-md">---</span>
                    <span class="w-1.5 h-1.5 rounded-full bg-blue-400 box-shadow"></span>
                    <span id="header-date" class="text-2xl text-shadow-md">--.--.----</span>
                </div>
            </div>

            <!-- Center: Building Title -->
            <div class="absolute left-1/2 transform -translate-x-1/2 flex items-center gap-4 top-8">
                <span class="text-4xl filter drop-shadow-lg opacity-90">ğŸŒ³</span>
                    <div class="text-center">
                        <div class="text-5xl drop-shadow mb-1">ğŸ¢</div>
                        <h1 class="text-4xl lg:text-5xl font-extrabold tracking-tight title-gradient">×‘×¨×•×›×™× ×”×‘××™× ×œ××œ×•× ×™× 8</h1>
                    </div>
                <span class="text-4xl filter drop-shadow-lg opacity-90">ğŸŒ³</span>
            </div>

            <!-- Left: Weather -->
            <div class="flex items-center gap-5">
                <!-- Using ID 1281409 for Beer Yaakov specifically -->
                <a href="https://www.accuweather.com/he/il/beer-yaaqov/1281409/weather-forecast/1281409" target="_blank" rel="noopener noreferrer" class="group flex items-center gap-5 cursor-pointer hover:opacity-100 opacity-90 transition-all transform hover:scale-105" title="×¦×¤×™×™×” ×‘×ª×—×–×™×ª ×”××œ××” ×‘-AccuWeather">
                    <div class="text-right">
                        <div class="text-sm text-blue-100 font-medium mb-0.5 group-hover:text-white transition-colors text-shadow-md">××–×’ ××•×•×™×¨</div>
                        <div id="header-weather-temp" class="text-4xl font-bold text-white drop-shadow-md">--Â°</div>
                    </div>
                    <div id="header-weather-icon" class="text-5xl filter drop-shadow-lg animate-float">...</div>
                </a>
            </div>
        </div>
    </header>
    
    <!-- ==================== MAIN DASHBOARD ==================== -->
    <main class="h-screen pt-36 pb-20 px-6 lg:px-10 max-w-[1920px] mx-auto">
        <div class="grid grid-cols-12 gap-6 h-full">
            
            <!-- ==================== RIGHT COLUMN: Shabbat & Info ==================== -->
            <div class="col-span-12 lg:col-span-3 flex flex-col gap-6">
                
                <!-- Info Card (Adjusted to fit content exactly - h-fit) -->
                <div class="glass-panel rounded-3xl h-fit flex flex-col">
                    <div class="p-5 border-b border-white/5 bg-white/5">
                        <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                            <span class="text-accent">â„¹ï¸</span> ××™×“×¢ ×©×™××•×©×™
                        </h2>
                    </div>
                    <!-- Removed flex-1 and overflow-y-auto to just show content -->
                    <div class="p-5 space-y-5">
                        <div class="flex gap-4 group">
                            <div class="icon-box w-12 h-12 bg-blue-500/10 text-blue-400 group-hover:bg-blue-500 group-hover:text-white transition-all duration-300 shrink-0 text-xl">ğŸ—‘ï¸</div>
                            <div>
                                <div class="text-white font-bold text-2xl">×¤×™× ×•×™ ××©×¤×”</div>
                                <div class="text-blue-200/80 text-lg">×¨××©×•×Ÿ, ×©×œ×™×©×™, ×—××™×©×™</div>
                            </div>
                        </div>
                        <div class="flex gap-4 group">
                            <div class="icon-box w-12 h-12 bg-yellow-500/10 text-yellow-400 group-hover:bg-yellow-500 group-hover:text-white transition-all duration-300 shrink-0 text-xl">ğŸ§¹</div>
                            <div>
                                <div class="text-white font-bold text-2xl">× ×™×§×™×•×Ÿ</div>
                                <div class="text-blue-200/80 text-lg">×§×•××•×ª: ×‘' ×•×”' | ××“×¨×’×•×ª: ×’'</div>
                            </div>
                        </div>
                        <div class="flex gap-4 group">
                            <div class="icon-box w-12 h-12 bg-emerald-500/10 text-emerald-400 group-hover:bg-emerald-500 group-hover:text-white transition-all duration-300 shrink-0 text-xl">ğŸŒ¿</div>
                            <div>
                                <div class="text-white font-bold text-2xl">×’×–×</div>
                                <div class="text-blue-200/80 text-lg">×™×•× ×©×œ×™×©×™</div>
                            </div>
                        </div>
                         <div class="flex gap-4 group">
                            <div class="icon-box w-12 h-12 bg-pink-500/10 text-pink-400 group-hover:bg-pink-500 group-hover:text-white transition-all duration-300 shrink-0 text-xl">ğŸ’³</div>
                            <div>
                                <div class="text-white font-bold text-2xl">×’×‘×™×™×” (DING)</div>
                                <div class="text-blue-200/80 text-lg font-mono">051-5246200 | pay@oxs.co.il</div>
                            </div>
                        </div>
                         <div class="flex gap-4 group">
                            <div class="icon-box w-12 h-12 bg-indigo-500/10 text-indigo-400 group-hover:bg-indigo-500 group-hover:text-white transition-all duration-300 shrink-0 text-xl">â˜ï¸</div>
                            <div>
                                <div class="text-white font-bold text-2xl">××•×§×“ ×¢×™×¨×•× ×™</div>
                                <div class="text-blue-200/80 text-lg">×—×™×™×’×• 106</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Shabbat Card (Expanded with uniform large fonts and candle animation) -->
                <a href="https://www.hebcal.com/" target="_blank" rel="noopener noreferrer" class="glass-panel rounded-3xl p-6 relative overflow-hidden group flex-1 flex flex-col justify-center hover:opacity-90 transition-opacity cursor-pointer">
                    <div class="absolute inset-0 bg-gradient-to-br from-indigo-900/50 to-purple-900/50 opacity-50"></div>
                    <div class="absolute -top-10 -right-10 w-32 h-32 bg-gold/20 rounded-full blur-3xl"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center justify-center p-4 bg-white/5 rounded-full mb-6 border border-white/10 shadow-inner">
                            <!-- Defined animation for candle -->
                            <span class="text-5xl filter drop-shadow-lg animate-flame block">ğŸ•¯ï¸</span>
                        </div>
                        <h3 class="text-3xl font-extrabold text-gold mb-2">×–×× ×™ ×”×©×‘×ª</h3>
                        <p id="parsha-name" class="text-xl text-blue-200/90 font-medium mb-1">× ×˜×¢×Ÿ...</p>
                        <p id="shabbat-date" class="text-lg text-blue-200/60 font-light mb-8">--.--.----</p>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between bg-black/30 p-4 rounded-2xl border border-white/10">
                                <span class="text-blue-100 text-xl font-medium">×›× ×™×¡×”</span>
                                <span id="shabbat-entry" class="text-4xl font-bold text-white tabular-nums tracking-wide">--:--</span>
                            </div>
                            <div class="flex items-center justify-between bg-black/30 p-4 rounded-2xl border border-white/10">
                                <span class="text-blue-100 text-xl font-medium">×™×¦×™××”</span>
                                <span id="shabbat-exit" class="text-4xl font-bold text-white tabular-nums tracking-wide">--:--</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            
            <!-- ==================== CENTER COLUMN: Notices (EXPANDED to col-span-9) ==================== -->
            <div class="col-span-12 lg:col-span-9 flex flex-col">
                <div class="glass-panel rounded-3xl flex-1 flex flex-col overflow-hidden relative">
                    <div class="p-6 border-b border-white/5 bg-white/5 flex items-center justify-between backdrop-blur-md sticky top-0 z-10">
                        <div class="flex items-center gap-4">
                            <h2 class="text-2xl font-extrabold text-white flex items-center gap-3">
                                <span class="text-3xl">ğŸ“£</span> ×œ×•×— ××•×“×¢×•×ª
                            </h2>
                            <button onclick="openAdminPanel()" class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition-all shadow-lg hover:scale-110" title="×”×•×¡×£ ××•×“×¢×”">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                                </svg>
                            </button>
                        </div>
                        <span class="px-4 py-1.5 rounded-full bg-white/10 text-sm font-medium text-blue-200 border border-white/5" id="notices-count">0 ×”×•×“×¢×•×ª</span>
                    </div>
                    <div id="notices-content" class="custom-scroll flex-1 overflow-y-auto p-6 space-y-5">
                        <div class="flex flex-col items-center justify-center h-full text-blue-300/30" id="no-notices">
                            <div class="text-8xl mb-6 opacity-20">ğŸ“­</div>
                            <p class="text-2xl font-light">××™×Ÿ ×”×•×“×¢×•×ª ×—×“×©×•×ª</p>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </main>
    
    <!-- ==================== NEWS TICKER ==================== -->
    <footer class="fixed bottom-0 left-0 right-0 z-30 bg-gray-900/90 backdrop-blur-md border-t border-white/10 shadow-2xl">
        <div class="flex items-center max-w-[1920px] mx-auto h-20">
            <a href="https://www.ynet.co.il/news/category/184" target="_blank" class="h-full bg-red-600 px-6 flex items-center justify-center gap-2 text-white font-bold hover:bg-red-700 transition-colors z-20 shadow-xl">
                <span>××‘×–×§×™×</span>
                <span class="animate-pulse w-2 h-2 bg-white rounded-full"></span>
            </a>
            <div class="flex-1 overflow-hidden relative h-full flex items-center">
                <div class="marquee-content" id="news-ticker">
                    <span class="text-white text-xl px-6">××¢×¨×›×ª ×”×—×“×©×•×ª ××ª×¢×“×›× ×ª...</span>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- ==================== ADMIN MODAL ==================== -->
    <div id="admin-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeAdminPanel()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
            <div class="glass-panel w-full max-w-lg rounded-3xl shadow-2xl transform transition-all scale-100 pointer-events-auto flex flex-col max-h-[90vh]">
                <div class="p-6 border-b border-white/10 flex items-center justify-between bg-white/5 rounded-t-3xl">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">ğŸ“ ×”×•×¡×¤×ª ××•×“×¢×” ×—×“×©×”</h2>
                    <button onclick="closeAdminPanel()" class="text-white/40 hover:text-white transition-colors">âœ•</button>
                </div>

                <div class="p-6 space-y-5 overflow-y-auto custom-scroll">
                    <!-- REMOVED: Post Type Selector -->

                    <div>
                        <label class="block text-blue-200/80 text-sm font-medium mb-2">×›×•×ª×¨×ª</label>
                        <input type="text" id="notice-title" class="w-full px-4 py-3 rounded-xl focus:ring-2 focus:ring-accent bg-transparent text-right" placeholder="×œ×“×•×’××”: ×™×•× ×”×•×œ×“×ª ×œ..." dir="rtl">
                    </div>
                    
                    <div>
                        <label class="block text-blue-200/80 text-sm font-medium mb-2">×ª×•×›×Ÿ</label>
                        <textarea id="notice-content" rows="3" class="w-full px-4 py-3 rounded-xl focus:ring-2 focus:ring-accent bg-transparent resize-none text-right" placeholder="×¤×¨×˜×™× × ×•×¡×¤×™×..." dir="rtl"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-blue-200/80 text-sm font-medium mb-2">×§×˜×’×•×¨×™×”</label>
                            <select id="notice-category" class="w-full px-4 py-3 rounded-xl bg-transparent">
                                <optgroup label="×›×œ×œ×™">
                                    <option value="general" class="text-black">ğŸ“¢ ×›×œ×œ×™</option>
                                    <option value="maintenance" class="text-black">ğŸ”§ ×ª×—×–×•×§×”</option>
                                    <option value="important" class="text-black">âš ï¸ ×—×©×•×‘</option>
                                    <option value="vaad" class="text-black">ğŸ  ×•×¢×“</option>
                                </optgroup>
                                <optgroup label="×—×™×™ ×§×”×™×œ×”">
                                    <option value="birthday" class="text-black">ğŸ‚ ×™×•× ×”×•×œ×“×ª</option>
                                    <option value="holiday" class="text-black">ğŸ· ×—×’ ×•××•×¢×“</option>
                                    <option value="welcome" class="text-black">ğŸ‘‹ ×‘×¨×•×›×™× ×”×‘××™×</option>
                                    <option value="event" class="text-black">ğŸ‰ ××™×¨×•×¢</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-blue-200/80 text-sm font-medium mb-2">×ª××¨×™×š</label>
                            <input type="date" id="notice-date" class="w-full px-4 py-3 rounded-xl bg-transparent text-right">
                        </div>
                    </div>

                    <div>
                        <label class="block text-blue-200/80 text-sm font-medium mb-2">×¦×‘×¢ ×“×’×©</label>
                        <div class="flex gap-4 p-2 bg-white/5 rounded-xl justify-center">
                            <button type="button" class="w-8 h-8 rounded-full border-2 border-transparent transition-transform hover:scale-110 focus:ring-2 ring-offset-2 ring-offset-slate-900 selected-color ring-white" data-color="#38bdf8" style="background: #38bdf8;" onclick="selectColor(this)"></button>
                            <button type="button" class="w-8 h-8 rounded-full border-2 border-transparent transition-transform hover:scale-110 focus:ring-2 ring-offset-2 ring-offset-slate-900" data-color="#10b981" style="background: #10b981;" onclick="selectColor(this)"></button>
                            <button type="button" class="w-8 h-8 rounded-full border-2 border-transparent transition-transform hover:scale-110 focus:ring-2 ring-offset-2 ring-offset-slate-900" data-color="#f59e0b" style="background: #f59e0b;" onclick="selectColor(this)"></button>
                            <button type="button" class="w-8 h-8 rounded-full border-2 border-transparent transition-transform hover:scale-110 focus:ring-2 ring-offset-2 ring-offset-slate-900" data-color="#ef4444" style="background: #ef4444;" onclick="selectColor(this)"></button>
                            <button type="button" class="w-8 h-8 rounded-full border-2 border-transparent transition-transform hover:scale-110 focus:ring-2 ring-offset-2 ring-offset-slate-900" data-color="#a855f7" style="background: #a855f7;" onclick="selectColor(this)"></button>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 cursor-pointer" onclick="document.getElementById('notice-priority').click()">
                        <input type="checkbox" id="notice-priority" class="w-5 h-5 rounded border-gray-500 text-accent focus:ring-accent bg-transparent">
                        <label class="text-white text-sm cursor-pointer select-none">âš¡ ×¡××Ÿ ×›×“×—×•×£ (×”×‘×”×•×‘ ××“×•×)</label>
                    </div>
                </div>

                <div class="p-6 border-t border-white/10 bg-white/5 rounded-b-3xl flex justify-between">
                    <div class="flex gap-3">
                        <button onclick="exportNoticesJson()" class="px-4 py-2 rounded-xl text-xs font-medium text-white/60 hover:text-white hover:bg-white/10 transition-colors border border-white/10">×™×™×¦×•× JSON</button>
                        <button onclick="clearForm()" class="px-6 py-2 rounded-xl text-sm font-medium text-white/60 hover:text-white hover:bg-white/10 transition-colors">× ×§×”</button>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="closeAdminPanel()" class="px-6 py-2 rounded-xl text-sm font-medium text-white hover:bg-white/10 transition-colors">×‘×™×˜×•×œ</button>
                        <button onclick="addNotice()" class="px-6 py-2 rounded-xl text-sm font-bold bg-accent text-slate-900 hover:bg-accentLight shadow-lg shadow-accent/20 transition-all transform hover:-translate-y-1">×¤×¨×¡×</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        const CONFIG = {
            // Beer Yaakov Exact Coordinates
            location: { name: '×‘××¨ ×™×¢×§×‘', lat: 31.9424, lon: 34.8391 },
            // clock: every second, news: every 60s, weather: every 7.5 minutes
            intervals: { clock: 1000, news: 60000, weather: 450000 }
        };
        
        let notices = [];
        let selectedColor = '#38bdf8';

        // --- DEFAULT NOTICES (Fallback) ---
        // This ensures the screen works immediately without a server
        const DEFAULT_NOTICES = [
          {
            "id": "1",
            "title": "×”×ª×¨×¢×ª ××–×’ ××•×•×™×¨ ×¡×•×¢×¨!",
            "content": "×“×™×™×¨×™× ×™×§×¨×™×, × × ×œ×§×©×•×¨ ×—×¤×¦×™× ×‘××¨×¤×¡×•×ª, ×œ×¡×’×•×¨ ×—×œ×•× ×•×ª ×•×“×œ×ª×•×ª ×¤×ª×•×—×™×.\n××•××œ×¥ ×œ× ×œ×—× ×•×ª ××ª×—×ª ×œ×¢×¦×™×.\n\n×‘×‘×¨×›×”,\n×•×¢×“ ×”×‘×™×ª",
            "category": "important",
            "date": "2025-12-10",
            "color": "#ef4444",
            "priority": true,
            "type": "notice"
          },
          {
            "id": "2",
            "title": "×‘×¨×•×›×™× ×”×‘××™× ×œ×œ×•×— ×”××•×“×¢×•×ª ×”×“×™×’×™×˜×œ×™ ×”×—×“×© ×©×œ ×”×‘× ×™×™×Ÿ!",
            "content": "× ×©××— ×œ×©××•×¢ ××›× ×¨×¢×™×•× ×•×ª ×•×”×¦×¢×•×ª ×œ×©×™×¤×•×¨ ×”× ×¨××•×ª ×•×”×ª×›× ×™× ×”××•×¤×™×¢×™× ×‘×œ×•×—.\n×œ×”×¦×¢×•×ª ×•×©×™×¤×•×¨×™× × ×™×ª×Ÿ ×œ×¤× ×•×ª ×œ×•×¢×“ ×”×‘× ×™×™×Ÿ ×‘×•×•××˜×¡××¤: 052-4244788 (××•×¤×™×¨).",
            "category": "welcome",
            "date": "2025-12-10",
            "color": "#38bdf8",
            "priority": false,
            "type": "notice"
          },
          {
            "id": "3",
            "title": "×”×–×× ×” ×œ××¡×™×¤×ª ×“×™×™×¨×™×",
            "content": "×™×•× ×¨××©×•×Ÿ 23.12.25 | 20:00 | ×œ×•×‘×™ ×”×‘× ×™×™×Ÿ\n\n× ×“×•×Ÿ ×‘×©×™×¤×•×¨×™× ×œ×‘× ×™×™×Ÿ ×•× ×§×‘×œ ×”×¦×¢×•×ª.\n×©×™××• ×œ×‘: ×”×”×¦×‘×¢×” ×œ×‘×¢×œ×™ ×“×™×¨×•×ª ×‘×œ×‘×“, ××š ×”×”×—×œ×˜×•×ª ×™×—×™×™×‘×• ××ª ×›×•×œ×. × ×•×›×—×•×ª×›× ×—×©×•×‘×”!\n\n×”×•×¢×“ ×”×‘× ×™×™×Ÿ",
            "category": "event",
            "date": "2025-12-05",
            "color": "#f59e0b",
            "priority": false,
            "type": "notice"
          }
        ];
        
        document.addEventListener('DOMContentLoaded', () => {
            loadNotices();
            updateTime();
            fetchWeather();
            fetchShabbatTimes();
            fetchNewsFromRSS();
            document.getElementById('notice-date').valueAsDate = new Date();
            
            setInterval(updateTime, CONFIG.intervals.clock);
            setInterval(fetchNewsFromRSS, CONFIG.intervals.news);
            setInterval(fetchWeather, CONFIG.intervals.weather);
            
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeAdminPanel(); });
        });
        
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit', hour12: false });
            const dateStr = now.toLocaleDateString('he-IL', { day: 'numeric', month: 'numeric', year: 'numeric' });
            const dayStr = now.toLocaleDateString('he-IL', { weekday: 'long' });
            
            document.getElementById('header-time').textContent = timeStr;
            document.getElementById('header-date').textContent = dateStr;
            document.getElementById('header-day').textContent = dayStr;
        }
        
        // --- WEATHER LOGIC (Open-Meteo) ---
        async function fetchWeather() {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${CONFIG.location.lat}&longitude=${CONFIG.location.lon}&current_weather=true`);
                if (response.ok) {
                    const data = await response.json();
                    const temp = Math.round(data.current_weather.temperature);
                    const weatherCode = data.current_weather.weathercode;
                    const isDay = data.current_weather.is_day;
                    updateWeatherDisplay(temp, weatherCode, isDay);
                    updateBackgroundTheme(isDay, weatherCode);
                }
            } catch (error) { console.error('Weather error:', error); }
        }

        function updateBackgroundTheme(isDay, weatherCode) {
            const body = document.body;
            const themes = {
                day: {
                    clear: 'radial-gradient(circle at top left, #38bdf8 0%, #0ea5e9 30%, #0284c7 70%, #0369a1 100%)',
                    cloudy: 'radial-gradient(circle at top left, #94a3b8 0%, #64748b 30%, #475569 70%, #334155 100%)',
                    rain: 'radial-gradient(circle at top left, #334155 0%, #1e293b 50%, #0f172a 100%)',
                },
                night: {
                    default: 'radial-gradient(circle at top left, #020617 0%, #0b1120 18%, #111827 42%, #1e293b 75%, #020617 100%)'
                }
            };
            let theme = 'default';
            if (isDay) {
                if ([0, 1].includes(weatherCode)) theme = themes.day.clear;
                else if ([2, 3, 45, 48].includes(weatherCode)) theme = themes.day.cloudy;
                else theme = themes.day.rain;
            } else {
                theme = themes.night.default;
            }
            body.style.background = theme;
            body.style.backgroundSize = '200% 200%';
        }

        function updateWeatherDisplay(temp, weatherCode, isDay) {
            const getIcon = (code, day) => {
                const icons = {
                    0: day ? 'â˜€ï¸' : 'ğŸŒ™', 1: day ? 'ğŸŒ¤ï¸' : 'ğŸŒ™', 2: day ? 'â›…' : 'â˜ï¸', 3: 'â˜ï¸',
                    45: 'ğŸŒ«ï¸', 48: 'ğŸŒ«ï¸', 51: 'ğŸŒ§ï¸', 53: 'ğŸŒ§ï¸', 55: 'ğŸŒ§ï¸', 61: 'ğŸŒ§ï¸', 63: 'ğŸŒ§ï¸', 65: 'ğŸŒ§ï¸',
                    71: 'ğŸŒ¨ï¸', 73: 'ğŸŒ¨ï¸', 75: 'ğŸŒ¨ï¸', 80: 'ğŸŒ¦ï¸', 81: 'ğŸŒ¦ï¸', 82: 'ğŸŒ¦ï¸', 95: 'â›ˆï¸', 96: 'â›ˆï¸', 99: 'â›ˆï¸'
                };
                return icons[code] || (day ? 'ğŸŒ¡ï¸' : 'ğŸŒ™');
            };
            document.getElementById('header-weather-temp').textContent = `${temp}Â°`;
            document.getElementById('header-weather-icon').textContent = getIcon(weatherCode, isDay);
        }
        
        // --- SHABBAT LOGIC (Hebcal API) ---
        async function fetchShabbatTimes() {
            try {
                // Using precise coordinates for Beer Yaakov (31.94, 34.83)
                // lg=he ensures Hebrew response for Parsha
                const response = await fetch(`https://www.hebcal.com/shabbat?cfg=json&geo=pos&latitude=${CONFIG.location.lat}&longitude=${CONFIG.location.lon}&tzid=Asia/Jerusalem&M=on&lg=he`);
                
                if (response.ok) {
                    const data = await response.json();
                    let parsha = '', candleLighting = '--:--', havdalah = '--:--', shabbatDate = '';
                    
                    if (data.items) {
                        for (const item of data.items) {
                            if (item.category === 'parashat') {
                                parsha = item.hebrew || item.title;
                            }
                            else if (item.category === 'candles') {
                                candleLighting = formatTimeFromISO(item.date);
                                // Get date of Friday
                                const d = new Date(item.date);
                                shabbatDate = d.toLocaleDateString('he-IL', { day: 'numeric', month: 'numeric', year: 'numeric' });
                            }
                            else if (item.category === 'havdalah') {
                                havdalah = formatTimeFromISO(item.date);
                            }
                        }
                    }
                    
                    document.getElementById('parsha-name').textContent = parsha || '---';
                    document.getElementById('shabbat-date').textContent = shabbatDate || '';
                    document.getElementById('shabbat-entry').textContent = candleLighting;
                    document.getElementById('shabbat-exit').textContent = havdalah;
                }
            } catch (error) { 
                console.error('Shabbat error:', error); 
                document.getElementById('parsha-name').textContent = '×©×’×™××ª × ×ª×•× ×™×';
            }
        }
        
        function formatTimeFromISO(isoString) {
            return new Date(isoString).toLocaleTimeString('he-IL', { 
                hour: '2-digit', 
                minute: '2-digit', 
                hour12: false 
            });
        }
        
        // --- NEWS LOGIC ---
        async function fetchNewsFromRSS() {
            try {
                const rssUrl = 'http://www.ynet.co.il/Integration/StoryRss1854.xml';
                const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
                const response = await fetch(apiUrl);
                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'ok' && data.items?.length > 0) {
                        const newsItems = data.items.slice(0, 10).map(item => {
                            // RSS to JSON often returns UTC, adjusting visually if needed or just display time
                            const pubDate = new Date(item.pubDate);
                            return {
                                title: item.title.replace(/&quot;/g, '"'),
                                time: pubDate.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' }),
                                url: item.link
                            };
                        });
                        updateNewsTicker(newsItems);
                        return;
                    }
                }
            } catch (error) { console.error('News error:', error); }
            updateNewsTicker([{ title: '×‘×¨×•×›×™× ×”×‘××™× ×œ××œ×•× ×™× 8 - ××¢×¨×›×ª ×”× ×™×”×•×œ ×”×—×›××”', time: '', url: '#' }]);
        }
        
        function updateNewsTicker(newsItems) {
            const ticker = document.getElementById('news-ticker');
            const newsHtml = newsItems.map(item => `
                <span class="inline-flex items-center mx-10 text-xl">
                    <span class="ynet-icon mr-4 ml-1">y</span>
                    <span class="text-white font-bold ml-3 text-lg">${item.time}</span>
                    <span class="text-white text-2xl font-semibold tracking-wide ml-3">${item.title}</span>
                </span>
            `).join('');
            ticker.innerHTML = newsHtml + newsHtml;
        }
        
        /* --- Notices & Building News Logic (Admin System) --- */
        
        // Load notices from shared JSON file (with fallback to DEFAULT_NOTICES or localStorage)
        async function loadNotices() {
            try {
                // Try fetching external file (works if hosted on a server)
                // If running locally or as blob, this might fail, hence the try/catch
                const res = await fetch('notices.json?_=' + Date.now());
                if (!res.ok) throw new Error('HTTP ' + res.status);
                notices = await res.json();
            } catch (err) {
                console.warn('Could not load remote notices.json, checking localStorage or using defaults:', err);
                
                // Fallback 1: LocalStorage (saved edits)
                const stored = localStorage.getItem('lobby-notices');
                if (stored) {
                    notices = JSON.parse(stored);
                } else {
                    // Fallback 2: Default hardcoded data (from notices.json content)
                    notices = DEFAULT_NOTICES;
                }
            }

            // Ensure type field exists
            if (Array.isArray(notices)) {
                notices = notices.map(n => ({ ...n, type: n.type || 'notice' }));
            } else {
                notices = [];
            }
            renderAll();
        }

        // NOTE: In a static setup we cannot write back to notices.json from the browser.
        // This only keeps temporary/local changes on this device.
        function saveNotices() { localStorage.setItem('lobby-notices', JSON.stringify(notices)); }
        
        function renderAll() {
            renderNotices();
        }

        // Render Center Board (Notices)
        function renderNotices() {
            const container = document.getElementById('notices-content');
            const noNotices = document.getElementById('no-notices');
            const countEl = document.getElementById('notices-count');
            
            const boardNotices = notices.filter(n => n.type === 'notice');
            
            if (boardNotices.length === 0) {
                noNotices.style.display = 'flex';
                countEl.textContent = '0 ×”×•×“×¢×•×ª';
                container.querySelectorAll('.notice-item').forEach(el => el.remove());
                return;
            }
            
            noNotices.style.display = 'none';
            countEl.textContent = `${boardNotices.length} ×”×•×“×¢×•×ª`;
            
            container.querySelectorAll('.notice-item').forEach(el => el.remove());
            
            boardNotices.forEach(notice => {
                const el = createNoticeElement(notice, false);
                container.appendChild(el);
            });
        }
        
        // Element for Main Board
        // Increased font sizes for Notice Board (center)
        function createNoticeElement(notice) {
            const div = document.createElement('div');
            div.className = `notice-item p-5 rounded-2xl bg-white/5 border border-white/5 hover:bg-white/10 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg ${notice.priority ? 'priority-notice' : ''}`;
            div.dataset.id = notice.id;
            
            const emojis = { general: 'ğŸ“¢', maintenance: 'ğŸ”§', event: 'ğŸ‰', important: 'âš ï¸', billing: 'ğŸ’³', vaad: 'ğŸ ', birthday: 'ğŸ‚', holiday: 'ğŸ·', welcome: 'ğŸ‘‹' };
            const dateStr = new Date(notice.date).toLocaleDateString('he-IL');
            
            div.innerHTML = `
                <div class="flex gap-4">
                    <div class="flex flex-col items-center gap-1 min-w-[70px] border-l border-white/10 pl-4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl shadow-lg" style="background: ${notice.color}20; color: ${notice.color}; border: 1px solid ${notice.color}40;">
                            ${emojis[notice.category] || 'ğŸ“¢'}
                        </div>
                        <span class="text-xs text-gray-400 font-mono mt-1">${dateStr}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-3xl text-white mb-2 leading-tight">${escapeHtml(notice.title)}</h4>
                            ${notice.priority ? '<span class="text-sm text-red-400 font-bold border border-red-500/30 px-3 py-0.5 rounded-full bg-red-500/10">×“×—×•×£</span>' : ''}
                        </div>
                        <p class="text-gray-200 text-2xl leading-relaxed whitespace-pre-line font-light opacity-90">${escapeHtml(notice.content)}</p>
                    </div>
                    <button onclick="deleteNotice('${notice.id}')" class="self-start opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-400 transition-all p-1">âœ•</button>
                </div>
            `;
            div.classList.add('group');
            return div;
        }

        /* --- Admin Logic --- */
        function openAdminPanel() {
            document.getElementById('admin-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('notice-title').focus(), 100);
        }
        
        function closeAdminPanel() {
            document.getElementById('admin-modal').classList.add('hidden');
        }
        
        function selectColor(btn) {
            document.querySelectorAll('button[data-color]').forEach(b => b.classList.remove('ring-white', 'ring-2'));
            btn.classList.add('ring-white', 'ring-2');
            selectedColor = btn.dataset.color;
        }
        
        function addNotice() {
            const title = document.getElementById('notice-title').value.trim();
            const content = document.getElementById('notice-content').value.trim();
            const category = document.getElementById('notice-category').value;
            const date = document.getElementById('notice-date').value;
            const priority = document.getElementById('notice-priority').checked;
            
            if (!title) return;
            
            notices.unshift({
                id: Date.now().toString(),
                title, content, category,
                date: date || new Date().toISOString().split('T')[0],
                color: selectedColor,
                priority,
                type: 'notice' // Defaults to notice now
            });
            
            saveNotices();
            renderAll();
            closeAdminPanel();
            clearForm();
        }
        
        function deleteNotice(id) {
            if (confirm('×œ××—×•×§ ×¤×¨×™×˜ ×–×”?')) {
                notices = notices.filter(n => n.id !== id);
                saveNotices();
                renderAll();
            }
        }
        
        function clearForm() {
            document.getElementById('notice-title').value = '';
            document.getElementById('notice-content').value = '';
            document.getElementById('notice-category').value = 'general';
            document.getElementById('notice-priority').checked = false;
            document.getElementById('notice-date').valueAsDate = new Date();
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Helper: export current notices array as a downloadable JSON file
        function exportNoticesJson() {
            try {
                const dataStr = JSON.stringify(notices, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'notices.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('×§×•×‘×¥ notices.json ×”×•×¨×“. ×”×¢×ª×§ ××•×ª×• ×œ×ª×™×§×™×™×ª ×”×¤×¨×•×™×§×˜ ×›×“×™ ×œ×¢×“×›×Ÿ ××ª ×”×©×¨×ª.');
            } catch (e) {
                console.error('Export JSON failed', e);
                alert('××™×¨×¢×” ×©×’×™××” ×‘×™×¦×•× ×”-JSON.');
            }
        }
    </script>
</body>
</html>
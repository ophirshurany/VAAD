<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××œ×•× ×™× 8 - ××¡×š ×œ×•×‘×™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        cardBg: 'rgba(15, 23, 42, 0.85)', // Solid dark background, no blur needed
                        cardBorder: 'rgba(255, 255, 255, 0.1)',
                        accent: '#38bdf8', // Sky 400
                        gold: '#fbbf24', // Amber 400
                    },
                    fontFamily: {
                        heebo: ['Heebo', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'marquee': 'marquee 40s linear infinite',
                        'pulse-slow': 'pulse 3s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(50%)' } // RTL: Starts at 0, moves right (which reveals left content visually if row-reverse) 
                            // Correction for RTL ticker logic:
                            // We want text to enter from Left and exit Right? Or Enter Right and exit Left?
                            // Standard news ticker: Enters Right, Exits Left.
                            // In CSS translate, negative X moves left.
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* CSS Reset & Basics */
        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #172554 100%);
            color: #ffffff;
            margin: 0;
        }

        /* Scroller Animation Setup */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            /* RTL: start from right edge */
        }

        .marquee-content {
            display: inline-flex;
            align-items: center;
            direction: ltr;
            will-change: transform;
            width: max-content;
            /* Start off-screen to the right, then scroll left */
            animation: ticker-scroll var(--ticker-duration, 60s) linear infinite;
        }

        /* RTL Carousel Animation: Start from right edge, scroll left */
        @keyframes ticker-scroll {
            0% {
                /* Start with content positioned at the right edge (positive X) */
                transform: translateX(var(--ticker-start, 100%));
            }

            100% {
                /* End when content has scrolled fully left */
                transform: translateX(calc(var(--ticker-start, 0px) - var(--ticker-distance, 0px)));
            }
        }

        /* Panel Styling - Removed Blur, Added Contrast */
        .info-panel {
            background-color: rgba(15, 23, 42, 0.7);
            /* Dark semi-transparent */
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: none;
            /* Removed blur per request */
        }

        .header-glow {
            text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
        }

        /* Custom Scrollbar for Notices */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        /* Form Elements */
        input,
        select,
        textarea {
            background: rgba(0, 0, 0, 0.3) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }

        /* Hanukkah Candle Flame */
        .candle-flame {
            filter: drop-shadow(0 0 4px #fbbf24);
            animation: flame-flicker 1.5s infinite alternate;
        }

        @keyframes flame-flicker {
            0% {
                opacity: 0.8;
                transform: scale(0.95);
            }

            100% {
                opacity: 1;
                transform: scale(1.05);
            }
        }
    </style>
</head>

<body class="flex flex-col p-2 lg:p-4 min-h-screen lg:h-screen lg:overflow-hidden">

    <!-- App frame (adds top/bottom/side border like the panels) -->
    <div class="info-panel rounded-xl lg:rounded-3xl overflow-hidden flex flex-col w-full h-full shadow-3xl">

        <!-- TOP HEADER: Title Only (Date moved to sidebar) -->
        <header
            class="flex flex-col lg:flex-row items-center justify-between py-4 lg:py-0 px-4 lg:px-10 border-b border-white/10 bg-dark/50 z-20 shrink-0 lg:h-24 relative lg:static">
            <!-- Left spacer (weather moved to sidebar clock card) -->
            <div class="hidden lg:block w-[220px]"></div>

            <!-- Center Title -->
            <div class="text-center w-full lg:w-auto lg:absolute lg:left-1/2 lg:-translate-x-1/2">
                <h1
                    class="text-3xl lg:text-7xl font-black tracking-tight text-white header-glow drop-shadow-xl whitespace-nowrap">
                    ×‘×¨×•×›×™× ×”×‘××™× ×œ××œ×•× ×™× 8
                </h1>
            </div>

            <!-- Left spacer (menorah moved to the notices header line) -->
            <div class="hidden lg:block w-[260px]"></div>
        </header>

        <style>
            /* New Menorah Styles */
            .menorah-candle {
                width: 14px;
                height: 34px;
                background: linear-gradient(to right, #e2e8f0, #94a3b8, #e2e8f0);
                border-radius: 4px;
                position: relative;
                box-shadow: inset 0 -2px 4px rgba(0, 0, 0, 0.3);
            }

            .menorah-flame {
                position: absolute;
                top: -18px;
                left: 50%;
                transform: translateX(-50%) scale(0);
                width: 12px;
                height: 18px;
                background: radial-gradient(circle at 50% 80%, #fbbf24, #f59e0b, transparent 70%);
                border-radius: 50% 50% 20% 20%;
                filter: drop-shadow(0 0 4px #fbbf24);
                opacity: 0;
                transition: all 0.5s ease-out;
            }

            .menorah-candle.lit .menorah-flame {
                opacity: 1;
                transform: translateX(-50%) scale(1);
                animation: menorah-flicker 1.5s infinite alternate;
            }

            @keyframes menorah-flicker {
                0% {
                    opacity: 0.8;
                    transform: translateX(-50%) scale(0.95);
                }

                100% {
                    opacity: 1;
                    transform: translateX(-50%) scale(1.05);
                }
            }

            /* Shamash (Helper) - Optional, but keeping 8 as requested. 
           If needed we can add a 9th taller one, but user asked for 8. */
        </style>

        <!-- MAIN CONTENT -->
        <main
            class="flex-1 flex flex-col lg:grid lg:grid-cols-12 gap-4 lg:gap-6 p-4 lg:p-6 lg:pr-10 overflow-y-auto lg:overflow-hidden scrollbar-hide">

            <!-- RIGHT COLUMN: Date, Info, Shabbat -->
            <aside class="w-full lg:col-span-5 flex flex-col lg:grid lg:grid-rows-3 gap-4 lg:gap-6 lg:h-full shrink-0">

                <!-- 1. DATE & TIME (Moved here for alignment) -->
                <div
                    class="info-panel rounded-3xl p-4 lg:p-6 flex flex-col items-center text-center justify-center bg-gradient-to-br from-blue-900/40 to-slate-900/40 h-full min-h-0">
                    <div class="flex items-center justify-center gap-6 w-full">
                        <div id="clock-time"
                            class="text-6xl lg:text-7xl font-black text-white tabular-nums leading-none drop-shadow-lg">
                            --:--</div>

                        <!-- Weather Widget (compact one-line) -->
                        <div class="flex items-center gap-3 bg-white/5 px-4 py-3 rounded-3xl border border-white/10 cursor-pointer hover:bg-white/10 transition"
                            onclick="window.open('https://www.accuweather.com/he/il/beer-yaaqov/1281409/weather-forecast/1281409', '_blank')"
                            title="×¤×ª×— ×ª×—×–×™×ª ×‘-AccuWeather">
                            <span id="weather-icon" class="text-4xl lg:text-5xl">â˜€ï¸</span>
                            <div class="flex items-center gap-3 leading-none">
                                <span id="weather-temp" class="text-3xl lg:text-4xl font-black tabular-nums">--Â°</span>
                                <span class="text-white/20 text-3xl hidden lg:inline">Â·</span>
                                <span id="weather-desc"
                                    class="text-xl lg:text-3xl font-semibold text-blue-100 hidden sm:block">--</span>
                            </div>
                        </div>
                    </div>

                    <div class="h-px w-32 bg-white/20 my-2"></div>
                    <div id="clock-day"
                        class="text-3xl lg:text-3xl font-black text-accent inline-flex items-center justify-center gap-3"
                        dir="ltr">
                        <span id="clock-day-icon" class="text-3xl lg:text-4xl leading-none" dir="ltr"
                            aria-hidden="true">ğŸ“…</span>
                        <span id="clock-day-text" dir="rtl">---</span>
                    </div>
                    <div class="flex items-center gap-3 mt-1">
                        <div id="clock-date" class="text-xl lg:text-3xl text-blue-100/80 tracking-widest font-bold">
                            --.--.----
                        </div>
                        <span class="text-white/20">â€¢</span>
                        <div id="clock-hebrew-date" class="text-xl lg:text-3xl text-blue-100/90 font-bold">--</div>
                    </div>
                </div>

                <!-- 2. USEFUL INFO LIST -->
                <div
                    class="info-panel rounded-3xl flex flex-col overflow-hidden relative text-center h-full min-h-0">
                    <!-- Title Header -->
                    <div class="bg-blue-900/30 p-3 lg:p-5 border-b border-white/10 flex items-center justify-center">
                        <h2 class="text-3xl lg:text-4xl font-black text-white flex items-center gap-3">
                            <span class="text-3xl lg:text-5xl">â„¹ï¸</span> ××™×“×¢ ×œ×“×™×™×¨
                        </h2>
                    </div>

                    <!-- List -->
                    <div class="p-5 lg:p-6 space-y-5 lg:space-y-6 overflow-y-auto">
                        <div
                            class="flex items-center justify-between p-3 lg:p-4 rounded-lg bg-white/5 border border-white/5 hover:bg-white/10 transition text-right">
                            <div>
                                <div class="font-black text-xl lg:text-4xl mb-1">×¤×™× ×•×™ ××©×¤×”</div>
                                <div class="text-lg lg:text-4xl text-blue-200 font-medium">×¨××©×•×Ÿ, ×©×œ×™×©×™ ×•×—××™×©×™</div>
                            </div>
                            <div class="text-3xl lg:text-5xl opacity-90">ğŸ—‘ï¸</div>
                        </div>
                        <div
                            class="flex items-center justify-between p-3 lg:p-4 rounded-lg bg-white/5 border border-white/5 hover:bg-white/10 transition text-right">
                            <div>
                                <div class="font-black text-xl lg:text-4xl mb-1">× ×™×§×™×•×Ÿ</div>
                                <div class="text-lg lg:text-4xl text-blue-200 font-medium">×§×•××•×ª: ×©× ×™, ×—××™×©×™ ×•×©×™×©×™ |
                                    ××“×¨×’×•×ª ×©×œ×™×©×™
                                </div>
                            </div>
                            <div class="text-3xl lg:text-5xl opacity-90">ğŸ§¹</div>
                        </div>
                        <div
                            class="flex items-center justify-between p-3 lg:p-4 rounded-lg bg-white/5 border border-white/5 hover:bg-white/10 transition text-right">
                            <div>
                                <div class="font-black text-xl lg:text-4xl mb-1">×’×–×</div>
                                <div class="text-lg lg:text-4xl text-blue-200 font-medium">×©×œ×™×©×™</div>
                            </div>
                            <div class="text-3xl lg:text-5xl opacity-90">ğŸŒ¿</div>
                        </div>
                        <div
                            class="flex items-center justify-between p-3 lg:p-4 rounded-lg bg-white/5 border border-white/5 hover:bg-white/10 transition text-right">
                            <div>
                                <div class="font-black text-xl lg:text-4xl mb-1">××•×§×“ ×¢×™×¨×•× ×™</div>
                                <div class="text-3xl lg:text-4xl text-blue-200 font-mono font-black">106</div>
                            </div>
                            <div class="text-3xl lg:text-5xl opacity-90">ğŸ“</div>
                        </div>
                        <div
                            class="flex items-center justify-between p-3 lg:p-4 rounded-lg bg-white/5 border border-white/5 hover:bg-white/10 transition text-right">
                            <div>
                                <div class="font-black text-xl lg:text-4xl mb-1">×©×¨×•×ª ×’×‘×™×” DING</div>
                                <div class="text-lg lg:text-4xl text-blue-200 font-medium">×•×•××˜×¡××¤ - 051-5246200</div>
                            </div>
                            <div class="text-3xl lg:text-5xl opacity-90">ğŸ’³</div>
                        </div>
                    </div>
                </div>

                <!-- 3. SHABBAT / HOLIDAY WIDGET -->
                <div id="shabbat-widget"
                    class="info-panel rounded-3xl p-5 relative overflow-hidden bg-gradient-to-b from-slate-900 to-indigo-950/50 cursor-pointer hover:opacity-90 transition hover:shadow-lg hover:border-gold/30 text-center h-full min-h-0"
                    onclick="window.open('https://www.hebcal.com/', '_blank')" title="×¤×ª×— ×–×× ×™ ×©×‘×ª ×‘-Hebcal">
                    <!-- Shabbat Content -->
                    <div class="relative z-10">
                        <div class="flex items-center justify-center gap-3 mb-3">
                            <span class="text-3xl lg:text-4xl">ğŸ•¯ï¸</span>
                            <h3 id="shabbat-title" class="text-xl lg:text-3xl font-bold text-gold">×–×× ×™ ×”×©×‘×ª</h3>
                        </div>
                        <div class="text-lg lg:text-3xl text-blue-200 mb-4 border-b border-white/10 pb-2 font-medium">
                            <span id="shabbat-date-display">--.--.--</span>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div
                                class="bg-black/30 p-2 lg:p-3 rounded-xl text-center border border-white/10 shadow-inner">
                                <span class="block text-xl lg:text-4xl text-blue-300 mb-1">×›× ×™×¡×”</span>
                                <span id="shabbat-in"
                                    class="text-xl lg:text-3xl font-black text-white tabular-nums tracking-wide">--:--</span>
                            </div>
                            <div
                                class="bg-black/30 p-2 lg:p-3 rounded-xl text-center border border-white/10 shadow-inner">
                                <span class="block text-xl lg:text-4xl text-blue-300 mb-1">×™×¦×™××”</span>
                                <span id="shabbat-out"
                                    class="text-xl lg:text-3xl font-black text-white tabular-nums tracking-wide">--:--</span>
                            </div>
                        </div>
                    </div>
                </div>

            </aside>

            <!-- CENTER COLUMN: Notice Board -->
            <section class="w-full lg:col-span-7 flex flex-col h-[460px] lg:h-full relative shrink-0">
                <div
                    class="info-panel rounded-3xl flex-1 flex flex-col overflow-hidden relative border-t-4 border-t-accent/50">

                    <!-- Notice Board Header -->
                    <div
                        class="bg-white/5 p-4 lg:p-6 border-b border-white/10 flex flex-col lg:flex-row items-center justify-between z-10 gap-3 lg:gap-0">
                        <h2 class="text-3xl lg:text-4xl font-black text-white flex items-center gap-4 drop-shadow-md">
                            <span class="text-accent text-3xl lg:text-5xl">ğŸ“£</span> ×œ×•×— ××•×“×¢×•×ª
                        </h2>

                        <div class="flex items-center gap-2 lg:gap-4 w-full lg:w-auto justify-between lg:justify-end">
                            <!-- Hanukkah Menorah (moved here) -->
                            <div class="flex items-center gap-2 lg:gap-3 bg-indigo-900/40 px-3 lg:px-4 py-2 rounded-3xl border border-white/5 shadow-xl scale-90 lg:scale-100 origin-right"
                                title="×—× ×•×›×” 2025">
                                <span class="text-gold font-black text-xl lg:text-3xl">×—× ×•×›×”</span>
                                <div id="hanukkah-container" class="flex items-end gap-1 lg:gap-2">
                                    <!-- Candles injected by JS -->
                                </div>
                            </div>

                            <span id="notice-counter"
                                class="bg-white/10 px-4 py-2 rounded-full text-3xl font-black text-blue-100">×˜×•×¢×Ÿ...</span>
                            <!-- Add Button -->
                            <button onclick="openAdmin()"
                                class="w-10 h-10 rounded-full bg-white/5 hover:bg-accent/20 flex items-center justify-center text-white/50 hover:text-white transition">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Notices Container -->
                    <div id="notices-area" class="flex-1 relative p-6 lg:p-7 flex flex-col justify-center items-center">
                        <!-- Content injected via JS -->
                        <div id="empty-state" class="text-center opacity-30">
                            <div class="text-8xl mb-4">ğŸ“­</div>
                            <div class="text-3xl">××™×Ÿ ×”×•×“×¢×•×ª ×—×“×©×•×ª</div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="h-1 bg-white/5 w-full absolute bottom-0 left-0">
                        <div id="notice-progress" class="h-full bg-accent w-0 transition-all duration-100 ease-linear">
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <!-- FOOTER: News Ticker -->
        <footer
            class="h-20 lg:h-28 bg-dark border-t border-white/10 flex items-center relative z-30 shadow-3xl shrink-0">
            <!-- Badge (clickable) -->
            <a href="https://www.ynet.co.il/news/category/184" target="_blank" rel="noopener noreferrer"
                class="bg-red-600 h-full px-4 lg:px-10 flex items-center justify-center gap-2 lg:gap-3 z-20 shadow-[4px_0_10px_rgba(0,0,0,0.5)] hover:bg-red-700 transition-colors">
                <span class="font-black text-white text-2xl lg:text-4xl tracking-wider uppercase">××‘×–×§×™×</span>
                <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
            </a>

            <!-- Ticker Content -->
            <div class="marquee-container flex-1 h-full flex items-center bg-slate-900 text-xl lg:text-4xl">
                <div id="ticker-track" class="marquee-content flex items-center" style="direction: ltr;">
                    <!-- LTR container for transform logic -->
                    <!-- JS will duplicate content here -->
                    <span class="text-white/50 mx-4">××¢×¨×›×ª ×”×—×“×©×•×ª ××ª×¢×“×›× ×ª...</span>
                </div>
            </div>
        </footer>

    </div>

    <!-- ADMIN MODAL -->
    <div id="admin-modal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-slate-900 border border-white/20 w-full max-w-lg rounded-3xl shadow-3xl flex flex-col max-h-[90vh]">
            <div class="p-5 border-b border-white/10 flex justify-between items-center bg-white/5 rounded-t-3xl">
                <h3 class="text-xl font-bold">×”×•×¡×¤×ª ×”×•×“×¢×”</h3>
                <button onclick="closeAdmin()" class="text-white/50 hover:text-white">âœ•</button>
            </div>

            <div class="p-6 space-y-4 overflow-y-auto">
                <div>
                    <label class="block text-sm text-blue-200 mb-1">×›×•×ª×¨×ª</label>
                    <input type="text" id="input-title" class="w-full px-4 py-3 rounded-lg"
                        placeholder="×›×•×ª×¨×ª ×”×”×•×“×¢×”..." dir="rtl">
                </div>
                <div>
                    <label class="block text-sm text-blue-200 mb-1">×ª×•×›×Ÿ</label>
                    <textarea id="input-content" rows="4" class="w-full px-4 py-3 rounded-lg resize-none"
                        placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”..." dir="rtl"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-blue-200 mb-1">×¡×•×’</label>
                        <select id="input-type" class="w-full px-4 py-3 rounded-lg bg-slate-800">
                            <option value="general">ğŸ“¢ ×›×œ×œ×™</option>
                            <option value="important">âš ï¸ ×—×©×•×‘ ×××•×“</option>
                            <option value="event">ğŸ‰ ××™×¨×•×¢</option>
                            <option value="welcome">ğŸ‘‹ ×‘×¨×•×›×™× ×”×‘××™×</option>
                            <option value="maintenance">ğŸ”§ ×ª×—×–×•×§×”</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-blue-200 mb-1">×ª××¨×™×š</label>
                        <input type="date" id="input-date" class="w-full px-4 py-3 rounded-lg bg-slate-800 text-right">
                    </div>
                </div>

                <div class="flex items-center gap-2 p-3 bg-white/5 rounded-lg border border-white/5">
                    <input type="checkbox" id="input-urgent" class="w-5 h-5 accent-red-500">
                    <label for="input-urgent" class="text-sm cursor-pointer select-none">×¡××Ÿ ×›×“×—×•×£ (××¡×’×¨×ª ××“×•××”
                        ××”×‘×”×‘×ª)</label>
                </div>
            </div>

            <div class="p-5 border-t border-white/10 bg-white/5 rounded-b-3xl flex justify-between">
                <button onclick="clearInputs()" class="text-white/50 hover:text-white text-sm">× ×§×” ×˜×•×¤×¡</button>
                <div class="flex gap-3">
                    <button onclick="closeAdmin()" class="px-4 py-2 rounded-lg hover:bg-white/10">×‘×™×˜×•×œ</button>
                    <button onclick="saveNotice()"
                        class="px-6 py-2 bg-accent hover:bg-sky-400 text-slate-900 font-bold rounded-lg shadow-lg">×¤×¨×¡×</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // CONFIG
        const CITY_LAT = 31.9424; // Beer Yaakov
        const CITY_LON = 34.8391;
        const ROTATION_TIME = 6000; // 6 seconds per slide

        let notices = [];

        let currentIndex = 0;
        let rotationTimer;
        let progressTimer;

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', async () => {
            updateTime();
            setInterval(updateTime, 1000);

            updateHebrewDateToday();
            // Refresh Hebrew date occasionally (midnight rollover / long-running screen)
            setInterval(updateHebrewDateToday, 60 * 60 * 1000);

            updateHanukkahCandles();
            setInterval(updateHanukkahCandles, 60000);

            fetchWeather();
            setInterval(fetchWeather, 600000); // 10 min

            fetchShabbat(); // Once is usually enough for a lobby screen that refreshes, or refresh daily

            fetchNews();
            setInterval(fetchNews, 60000 * 5); // 5 min

            await loadNotices();
            renderNotices();
            document.getElementById('input-date').valueAsDate = new Date();
        });

        // --- CLOCK & DATE ---
        function updateTime() {
            const now = new Date();
            document.getElementById('clock-time').textContent = now.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
            const weekday = now.toLocaleDateString('he-IL', { weekday: 'long' });

            // Weekday icons (0=Sunday .. 6=Saturday)
            const weekdayIcons = ['â˜•', 'ğŸ’¼', 'âœ¨', 'ğŸª', 'ğŸ»', 'ğŸ·', 'ğŸ›‹ï¸'];
            const icon = weekdayIcons[now.getDay()] || '';

            const dayTextEl = document.getElementById('clock-day-text');
            const dayIconEl = document.getElementById('clock-day-icon');
            const dayContainerEl = document.getElementById('clock-day');

            if (dayTextEl && dayIconEl) {
                dayTextEl.textContent = weekday;
                dayIconEl.textContent = icon;
            } else if (dayContainerEl) {
                // Fallback if markup changes
                dayContainerEl.textContent = icon ? `${icon} ${weekday}` : weekday;
            }
            document.getElementById('clock-date').textContent = now.toLocaleDateString('he-IL', { day: 'numeric', month: 'numeric', year: 'numeric' });
        }

        // --- WEATHER ---
        async function fetchWeather() {
            try {
                // Simplified API call: Current weather only
                const url = `https://api.open-meteo.com/v1/forecast` +
                    `?latitude=${CITY_LAT}&longitude=${CITY_LON}` +
                    `&current_weather=true` +
                    `&timezone=Asia%2FJerusalem`;

                const res = await fetch(url);
                const data = await res.json();

                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;
                const isDay = data.current_weather.is_day; // 1 or 0 directly works

                document.getElementById('weather-temp').textContent = `${temp}Â°`;
                document.getElementById('weather-icon').textContent = getWeatherIcon(code, isDay);

                const descEl = document.getElementById('weather-desc');
                if (descEl) {
                    // Using local mapping based only on WMO code
                    descEl.textContent = getWeatherHebrewSummary({ code, isDay });
                }
            } catch (e) {
                console.error('Weather error', e);
                const descEl = document.getElementById('weather-desc');
                if (descEl) descEl.textContent = '××–×’ ××•×•×™×¨';
            }
        }

        function getWeatherHebrewSummary({ code, cloud, pop, precip, isDay }) {
            // Precipitation first (closest to AccuWeather-style phrasing)
            const hasPrecip = (typeof precip === 'number' && precip > 0.0) || (typeof pop === 'number' && pop >= 50);
            if (hasPrecip) {
                if ([80, 81, 82].includes(code)) return '×××˜×¨×™× ×§×¦×¨×™×';
                if ([61, 63, 65, 66, 67].includes(code)) return '×’×©×•×';
                if ([51, 53, 55].includes(code)) return '×˜×¤×˜×•×£';
                if ([95, 96, 99].includes(code)) return '×¡×•×¤×•×ª ×¨×¢××™×';
                return '×××˜×¨×™× ×§×¦×¨×™×';
            }

            // Cloud-based sky description
            if (typeof cloud === 'number') {
                if (cloud >= 85) return '××¢×•× ×Ÿ';
                if (cloud >= 45) return '××¢×•× ×Ÿ ×—×œ×§×™×ª';
                if (cloud >= 20) return isDay ? '×©××©×™ ×‘×¢×™×§×¨' : '×‘×”×™×¨ ×‘×¢×™×§×¨';
                return isDay ? '×©××©×™' : '×‘×”×™×¨';
            }

            // Fallback to weathercode only
            if (code === 0) return isDay ? '×©××©×™' : '×‘×”×™×¨';
            if (code === 1) return isDay ? '×©××©×™ ×‘×¢×™×§×¨' : '×‘×”×™×¨ ×‘×¢×™×§×¨';
            if (code === 2) return '××¢×•× ×Ÿ ×—×œ×§×™×ª';
            if (code === 3) return '××¢×•× ×Ÿ';
            if ([45, 48].includes(code)) return '×¢×¨×¤×™×œ×™';
            if ([51, 53, 55].includes(code)) return '×˜×¤×˜×•×£';
            if ([61, 63, 65].includes(code)) return '×’×©×•×';
            if ([80, 81, 82].includes(code)) return '×××˜×¨×™× ×§×¦×¨×™×';
            if ([95, 96, 99].includes(code)) return '×¡×•×¤×•×ª ×¨×¢××™×';
            return '××–×’ ××•×•×™×¨';
        }

        function getWeatherIcon(code, isDay) {
            const icons = {
                0: isDay ? 'â˜€ï¸' : 'ğŸŒ™',
                1: isDay ? 'ğŸŒ¤ï¸' : 'ğŸŒ™',
                2: isDay ? 'â›…' : 'â˜ï¸',
                3: 'â˜ï¸',
                45: 'ğŸŒ«ï¸', 48: 'ğŸŒ«ï¸',
                51: 'ğŸŒ§ï¸', 53: 'ğŸŒ§ï¸', 55: 'ğŸŒ§ï¸',
                61: 'ğŸŒ§ï¸', 63: 'ğŸŒ§ï¸', 65: 'ğŸŒ§ï¸',
                80: 'ğŸŒ¦ï¸', 81: 'ğŸŒ¦ï¸', 82: 'ğŸŒ¦ï¸',
                95: 'â›ˆï¸', 96: 'â›ˆï¸', 99: 'â›ˆï¸'
            };
            return icons[code] || (isDay ? 'â˜€ï¸' : 'ğŸŒ™');
        }

        // --- SHABBAT ---
        async function fetchShabbat() {
            try {
                const res = await fetch(`https://www.hebcal.com/shabbat?cfg=json&geo=pos&latitude=${CITY_LAT}&longitude=${CITY_LON}&tzid=Asia/Jerusalem&M=on&lg=he`);
                const data = await res.json();

                // Parse Items
                let parsha = '', candle = '--:--', havdalah = '--:--';
                let candleDate = null;

                data.items.forEach(item => {
                    if (item.category === 'parashat') parsha = item.hebrew;
                    if (item.category === 'candles') {
                        candleDate = new Date(item.date);
                        candle = candleDate.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
                    }
                    if (item.category === 'havdalah') {
                        havdalah = new Date(item.date).toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
                    }
                });

                document.getElementById('shabbat-in').textContent = candle;
                document.getElementById('shabbat-out').textContent = havdalah;

                // Title: "×–×× ×™ ×”×©×‘×ª - ×¤×¨×©×ª ..."
                const shabbatTitleEl = document.getElementById('shabbat-title');
                const cleanParsha = stripHebrewNiqqud(parsha || '').trim();
                if (shabbatTitleEl) {
                    shabbatTitleEl.textContent = cleanParsha ? `×–×× ×™ ×”×©×‘×ª - ${cleanParsha}` : '×–×× ×™ ×”×©×‘×ª';
                }

                // Date line should be: "×™×•× ×©×™×©×™, 12 ×‘×“×¦××‘×¨ 2025 â€¢ ×›"×‘ ... ×ª×©×¤"×•"
                // Use the candle lighting date (Friday) as reference.
                const d = candleDate || new Date();
                const gy = d.getFullYear();
                const gm = d.getMonth() + 1;
                const gd = d.getDate();

                // Fetch full Converter data
                const dateRes = await fetch(`https://www.hebcal.com/converter?cfg=json&gy=${gy}&gm=${gm}&gd=${gd}&g2h=1&lg=he`);
                if (dateRes.ok) {
                    const dateData = await dateRes.json();
                    const hebrewDate = stripHebrewNiqqud(dateData.hebrew || '').trim();

                    // Format Gregorian Date: "×™×•× ×©×™×©×™, 12 ×‘×“×¦××‘×¨ 2025"
                    const weekday = d.toLocaleDateString('he-IL', { weekday: 'long' });
                    const weekdayLabel = weekday.startsWith('×™×•×') ? weekday : `×™×•× ${weekday}`;
                    const gregDate = `${weekdayLabel}, ${d.toLocaleDateString('he-IL', { day: 'numeric', month: 'long', year: 'numeric' })}`;

                    const fullString = hebrewDate ? `${gregDate} â€¢ ${hebrewDate}` : gregDate;
                    document.getElementById('shabbat-date-display').textContent = fullString;
                } else {
                    // Fallback
                    const weekday = d.toLocaleDateString('he-IL', { weekday: 'long' });
                    const weekdayLabel = weekday.startsWith('×™×•×') ? weekday : `×™×•× ${weekday}`;
                    const gregDate = `${weekdayLabel}, ${d.toLocaleDateString('he-IL', { day: 'numeric', month: 'long', year: 'numeric' })}`;
                    document.getElementById('shabbat-date-display').textContent = gregDate;
                }

            } catch (e) { console.error('Shabbat API error', e); }
        }

        function stripHebrewNiqqud(text) {
            return (text || '').replace(/[\u0591-\u05C7]/g, '');
        }

        async function updateHebrewDateToday() {
            const el = document.getElementById('clock-hebrew-date');
            if (!el) return;
            try {
                const today = new Date();
                const gy = today.getFullYear();
                const gm = today.getMonth() + 1;
                const gd = today.getDate();
                const res = await fetch(`https://www.hebcal.com/converter?cfg=json&gy=${gy}&gm=${gm}&gd=${gd}&g2h=1&lg=he`);
                if (!res.ok) throw new Error('HTTP ' + res.status);
                const data = await res.json();
                // Example: "×›×´×‘ ×›Ö´Ö¼×¡Ö°×œÖµ×• ×ª×©×¤×´×•"
                el.textContent = stripHebrewNiqqud(data.hebrew || '').trim() || '--';
            } catch (e) {
                console.warn('Hebrew date fetch failed', e);
                el.textContent = '--';
            }
        }

        // --- NEWS TICKER ---
        async function fetchNews() {
            const track = document.getElementById('ticker-track');
            try {
                // Using Ynet RSS via RSS2JSON proxy
                const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=http://www.ynet.co.il/Integration/StoryRss1854.xml');
                const data = await res.json();

                if (data.status === 'ok' && data.items.length > 0) {
                    // Build items with clickable links
                    const items = data.items.map(i => {
                        const time = new Date(i.pubDate).toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
                        const title = i.title.replace(/"/g, '');
                        const link = i.link || '#';
                        return `
                            <a href="${link}" target="_blank" class="inline-flex items-center gap-3 px-8 flex-row-reverse hover:bg-white/10 transition rounded-lg py-1" dir="rtl" title="×œ×—×¥ ×œ×§×¨×™××”">
                                <span class="text-accent font-black tabular-nums text-3xl">${time}</span>
                                <span class="text-white font-semibold text-3xl hover:text-accent transition">${title}</span>
                                <span class="text-white/20">|</span>
                            </a>
                        `;
                    }).join('');

                    // Insert ONE copy only.
                    track.innerHTML = items;

                    // SAVE FRESH CONTENT for the setup function
                    window.tickerOriginalContent = Array.from(track.children).map(c => c.cloneNode(true));

                    setupTickerAnimation(track);
                }
            } catch (e) {
                console.log('News Error, using fallback');
                const fallback = `<span class="px-8 text-xl">×‘×¨×•×›×™× ×”×‘××™× ×œ××œ×•× ×™× 8 â€¢ × ×©××— ×œ×¢××•×“ ×œ×©×™×¨×•×ª×›× â€¢ ×™×•× × ×¢×™×</span>`;
                track.innerHTML = fallback;

                // SAVE FALLBACK too
                window.tickerOriginalContent = Array.from(track.children).map(c => c.cloneNode(true));

                setupTickerAnimation(track);
            }
        }

        // Recalculate ticker when viewport changes (TV/browser resize) to keep the loop seamless.
        window.addEventListener('resize', () => {
            const track = document.getElementById('ticker-track');
            if (track) setupTickerAnimation(track);
        });

        function setupTickerAnimation(track) {
            try {
                // 1. Reset animation
                track.style.animation = 'none';
                track.innerHTML = '';

                // 2. Get the original items
                if (!window.tickerOriginalContent || window.tickerOriginalContent.length === 0) return;
                const originals = window.tickerOriginalContent;

                // 3. Measure Single Set Width
                const tempContainer = document.createElement('div');
                Object.assign(tempContainer.style, {
                    position: 'absolute', visibility: 'hidden', whiteSpace: 'nowrap', display: 'inline-flex'
                });
                originals.forEach(node => tempContainer.appendChild(node.cloneNode(true)));
                document.body.appendChild(tempContainer);
                const singleSetWidth = tempContainer.getBoundingClientRect().width;
                document.body.removeChild(tempContainer);

                if (singleSetWidth === 0) return;

                // 4. For seamless RTL carousel:
                // We need content to START from the right edge (off-screen) and scroll left.
                // Then loop back seamlessly.
                const screenWidth = window.innerWidth;

                // Build enough content to fill: screen + one full set (for seamless loop)
                const nodesToAppend = [];
                let currentWidth = 0;
                const targetWidth = screenWidth + singleSetWidth * 2; // Extra buffer for smooth loop

                while (currentWidth < targetWidth) {
                    originals.forEach(node => nodesToAppend.push(node.cloneNode(true)));
                    currentWidth += singleSetWidth;
                }

                // 5. Append content to track
                const fragment = document.createDocumentFragment();
                nodesToAppend.forEach(node => fragment.appendChild(node));
                track.appendChild(fragment);

                // 6. Calculate animation values
                const totalWidth = track.scrollWidth;
                const scrollDistance = singleSetWidth; // Scroll exactly one set for seamless loop

                // 7. Set CSS Variables
                // --ticker-start: Start position (screen width = off-screen right)
                // --ticker-distance: How far to scroll (one set width for seamless loop)
                track.style.setProperty('--ticker-start', `${screenWidth}px`);
                track.style.setProperty('--ticker-distance', `${scrollDistance}px`);

                // Duration based on total travel distance
                const pxPerSec = 80;
                const totalTravel = screenWidth + scrollDistance;
                const duration = totalTravel / pxPerSec;
                track.style.setProperty('--ticker-duration', `${duration}s`);

                // 8. Force reflow and restart animation
                void track.offsetHeight;
                track.style.animation = '';

            } catch (e) {
                console.warn('Ticker setup failed', e);
            }
        }


        // --- NOTICES LOGIC ---
        function renderNotices() {
            const area = document.getElementById('notices-area');
            const counter = document.getElementById('notice-counter');

            clearInterval(rotationTimer);
            clearInterval(progressTimer);

            if (notices.length === 0) {
                area.innerHTML = document.getElementById('empty-state').outerHTML;
                document.getElementById('empty-state').style.display = 'block';
                counter.textContent = '0 ×”×•×“×¢×•×ª';
                return;
            }

            counter.textContent = `${notices.length} ×”×•×“×¢×•×ª`;

            // Start Rotation
            showNotice(0);
            startRotation();
        }

        function startRotation() {
            const bar = document.getElementById('notice-progress');
            let width = 0;
            const step = 100 / (ROTATION_TIME / 50); // Update every 50ms

            progressTimer = setInterval(() => {
                width += step;
                if (width >= 100) width = 100;
                bar.style.width = width + '%';
            }, 50);

            rotationTimer = setInterval(() => {
                currentIndex = (currentIndex + 1) % notices.length;
                showNotice(currentIndex);
                width = 0;
                bar.style.width = '0%';
            }, ROTATION_TIME);
        }

        function showNotice(index) {
            const area = document.getElementById('notices-area');
            const notice = notices[index];
            const iconMap = {
                'welcome': 'ğŸ‘‹', 'event': 'ğŸ‰', 'important': 'âš ï¸', 'maintenance': 'ğŸ”§', 'general': 'ğŸ“¢'
            };
            const icon = iconMap[notice.type] || 'ğŸ“¢';

            // Image vs Icon
            let visualContent;
            if (notice.imageUrl) {
                // Keep correct proportions (no crop). Use different max-height if there's also text.
                const hasText = (notice.content || '').trim().length > 0;
                const maxH = hasText ? 'max-h-[42vh] lg:max-h-[48vh]' : 'max-h-[60vh] lg:max-h-[70vh]';
                visualContent = `
                    <img
                        src="${notice.imageUrl}"
                        class="${maxH} w-full max-w-[1200px] h-auto rounded-2xl shadow-3xl mb-4 object-contain bg-black/20 border border-white/10"
                        alt="Notice Image"
                        loading="lazy"
                        decoding="async"
                    >
                `;
            } else {
                visualContent = `<div class="text-8xl mb-6 filter drop-shadow-lg">${icon}</div>`;
            }

            const urgencyClass = notice.urgent ? 'border-2 border-red-500 shadow-[0_0_50px_rgba(239,68,68,0.2)]' : '';
            const urgencyBadge = notice.urgent ? '<div class="absolute top-4 left-4 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold animate-pulse">×“×—×•×£</div>' : '';

            // Animation classes
            const html = `
        <div class="w-full h-full flex flex-col items-center justify-center text-center animate-fade-in relative p-4 ${urgencyClass} rounded-3xl bg-white/5">
            ${urgencyBadge}
            ${visualContent}
            <h2 class="text-5xl lg:text-6xl font-black text-white mb-5 leading-tight drop-shadow-md max-w-4xl">${notice.title}</h2>
            <p class="text-3xl lg:text-4xl text-blue-100 font-light whitespace-pre-line leading-relaxed max-w-5xl">${notice.content}</p>
            <div class="mt-8 text-blue-300 font-medium text-xl border-t border-white/10 pt-4 px-8">
                ×¤×•×¨×¡× ×‘: ${notice.date} â€¢ ×•×¢×“ ×”×‘×™×ª
            </div>
            
            <button onclick="deleteNotice(${notice.id})" class="absolute bottom-4 left-4 text-white/10 hover:text-red-500 transition p-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `;

            area.innerHTML = html;
        }

        // --- ADMIN FUNCTIONS ---
        function openAdmin() { document.getElementById('admin-modal').classList.remove('hidden'); }
        function closeAdmin() { document.getElementById('admin-modal').classList.add('hidden'); }
        function clearInputs() {
            document.getElementById('input-title').value = '';
            document.getElementById('input-content').value = '';
            document.getElementById('input-urgent').checked = false;
        }

        function saveNotice() {
            const title = document.getElementById('input-title').value;
            const content = document.getElementById('input-content').value;
            if (!title) return alert('× × ×œ×”×–×™×Ÿ ×›×•×ª×¨×ª');

            const newNotice = {
                id: Date.now().toString(),
                title: title,
                content: content,
                type: document.getElementById('input-type').value,
                date: document.getElementById('input-date').value,
                urgent: document.getElementById('input-urgent').checked
            };

            notices.unshift(newNotice); // Add to top
            saveNotices(); // Save to storage
            renderNotices();
            closeAdmin();
            clearInputs();
        }

        function deleteNotice(id) {
            if (confirm('×œ××—×•×§ ×”×•×“×¢×” ×–×•?')) {
                notices = notices.filter(n => n.id !== id.toString()); // Ensure string comparison
                saveNotices(); // Save to storage
                renderNotices();
            }
        }

        // --- PERSISTENCE ---
        // Load from notices.json (shared), fallback to localStorage (local edits)
        async function loadNotices() {
            // If opened directly from disk (file://), browsers often block fetch() to local json.
            // In that case we'll fall back to localStorage, which may look "stuck" if you edit notices.json.
            if (window.location.protocol === 'file:') {
                console.warn('Running from file:// - notices.json fetch may be blocked. Start a local HTTP server to load notices.json reliably.');
            }

            // 1) Try notices.json (works when served over HTTP)
            try {
                const res = await fetch('notices.json?_=' + Date.now());
                if (res.ok) {
                    const json = await res.json();
                    if (Array.isArray(json)) {
                        notices = mapNoticesFromJson(json);
                        // Cache locally so the TV can still work offline later
                        saveNotices();
                        const counter = document.getElementById('notice-counter');
                        if (counter) counter.textContent = `${notices.length} ×”×•×“×¢×•×ª`;
                        return;
                    }
                }
            } catch (e) {
                console.warn('Could not load notices.json, falling back to localStorage', e);
            }

            // 2) Fallback to localStorage
            const stored = localStorage.getItem('lobby-notices');
            notices = stored ? JSON.parse(stored) : [];
            const counter = document.getElementById('notice-counter');
            if (counter) counter.textContent = `${notices.length} ×”×•×“×¢×•×ª`;
        }

        function mapNoticesFromJson(items) {
            // Your notices.json schema:
            // { id, title, content, category, date, color, priority, type, imageUrl }
            // Current UI expects:
            // { id, title, content, type, date, urgent, imageUrl }
            const mapType = {
                general: 'general',
                important: 'important',
                event: 'event',
                welcome: 'welcome',
                maintenance: 'maintenance',
                vaad: 'important',
                holiday: 'event'
            };
            return items
                // Only show notice-board items here; ignore "news" entries
                .filter(n => (n.type || 'notice') === 'notice')
                .map(n => ({
                    id: String(n.id ?? Date.now()),
                    title: n.title || '',
                    content: n.content || '',
                    type: mapType[n.category] || mapType[n.type] || 'general',
                    date: n.date || new Date().toISOString().split('T')[0],
                    urgent: Boolean(n.priority),
                    imageUrl: n.imageUrl ?? null
                }));
        }
        function saveNotices() {
            localStorage.setItem('lobby-notices', JSON.stringify(notices));
        }

        // --- HANUKKAH MENORAH LOGIC ---
        // 8 Candles. Dates: Dec 14 - Dec 21, 2025. Lighting: 18:00.
        function updateHanukkahCandles() {
            const container = document.getElementById('hanukkah-container');
            if (!container) return;

            // Define Schedule: [Date Object for lighting time]
            const year = 2025;
            const candlesSchedule = [
                new Date(`${year}-12-14T18:00:00`),
                new Date(`${year}-12-15T18:00:00`),
                new Date(`${year}-12-16T18:00:00`),
                new Date(`${year}-12-17T18:00:00`),
                new Date(`${year}-12-18T18:00:00`),
                new Date(`${year}-12-19T18:00:00`),
                new Date(`${year}-12-20T18:00:00`),
                new Date(`${year}-12-21T18:00:00`)
            ];

            const now = new Date();

            // Calculate how many should be lit
            let litCount = 0;
            candlesSchedule.forEach((time, index) => {
                if (now >= time) {
                    litCount = index + 1;
                }
            });

            // If empty (first run), build DOM
            if (container.children.length === 0) {
                // Add 8 candles
                for (let i = 0; i < 8; i++) {
                    const candle = document.createElement('div');
                    candle.className = 'menorah-candle';
                    // Flame
                    const flame = document.createElement('div');
                    flame.className = 'menorah-flame';
                    candle.appendChild(flame);
                    container.appendChild(candle);
                }
            }

            // Update Lit State
            const candles = Array.from(container.children);
            candles.forEach((candle, index) => {
                if (index < litCount) {
                    candle.classList.add('lit');
                } else {
                    candle.classList.remove('lit');
                }
            });
        }

        // --- OLD LOGIC (Ignored) ---
        const HANUKKAH = { start: '2025-12-14', end: '2025-12-22' };

        function updateHanukkahUI() {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const badge = document.getElementById('hanukkah-badge');

            // Simple date check
            const isHanukkah = (dateStr >= HANUKKAH.start && dateStr <= HANUKKAH.end);
            // Check if "Coming Soon" (7 days before)
            const startObj = new Date(HANUKKAH.start);
            const diffTime = startObj - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const isComingSoon = (diffDays > 0 && diffDays <= 7);

            if (isHanukkah || isComingSoon) {
                badge.classList.remove('hidden');
                badge.classList.add('flex');
            } else {
                badge.classList.add('hidden');
                badge.classList.remove('flex');
            }
        }

    </script>
</body>

</html>